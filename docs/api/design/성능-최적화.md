# ⚡ 성능 최적화

## 필드 선택 (Sparse Fieldsets)

**클라이언트가 필요한 필드만 요청:**

```http
GET /api/v1/users?fields=id,username,email
```

```json
{
  "success": true,
  "data": {
    "items": [
      {
        "id": "01ARZ3...",
        "username": "admin",
        "email": "admin@example.com"
        // createdAt, updatedAt 등 생략됨
      }
    ]
  }
}
```

## 관계 확장 (Expand/Include)

**관련 리소스 포함:**

```http
GET /api/v1/users/{id}?expand=organization,permissions
```

```json
{
  "success": true,
  "data": {
    "id": "01ARZ3...",
    "username": "admin",
    "organization": {               // ✅ 확장됨
      "id": "01ORG...",
      "name": "ABC Bank"
    },
    "permissions": [                // ✅ 확장됨
      { "id": "01PERM...", "code": "user:read" }
    ]
  }
}
```

## 캐싱

**Cache-Control 헤더:**

```http
# 정적 데이터 (코드, 상수)
Cache-Control: public, max-age=86400  # 1일

# 동적 데이터 (사용자 정보)
Cache-Control: private, max-age=300   # 5분

# 캐싱 금지 (민감한 데이터)
Cache-Control: no-store
```

**ETag 사용:**

```http
# 첫 요청
GET /api/v1/users/{id}
→ 200 OK
ETag: "686897696a7c876b7e"

# 이후 요청
GET /api/v1/users/{id}
If-None-Match: "686897696a7c876b7e"
→ 304 Not Modified (변경 없음)
```

## Batch 요청

**다중 리소스 조회:**

```http
POST /api/v1/users/_batch
Content-Type: application/json

{
  "ids": [
    "01ARZ3...",
    "01BRZ3...",
    "01CRZ3..."
  ]
}
```

```json
{
  "success": true,
  "data": [
    { "id": "01ARZ3...", "username": "user1" },
    { "id": "01BRZ3...", "username": "user2" },
    { "id": "01CRZ3...", "username": "user3" }
  ]
}
```

## 비동기 처리

**장시간 소요 작업:**

```http
# 비동기 작업 시작
POST /api/v1/detection/inspect
→ 202 Accepted
Location: /api/v1/jobs/01JOB123...

{
  "success": true,
  "message": "Inspection job started",
  "data": {
    "jobId": "01JOB123...",
    "status": "PROCESSING"
  }
}

# 진행 상태 확인
GET /api/v1/jobs/01JOB123...
→ 200 OK

{
  "success": true,
  "data": {
    "jobId": "01JOB123...",
    "status": "COMPLETED",
    "progress": 100,
    "result": {
      "totalProcessed": 10000,
      "eventsGenerated": 45
    }
  }
}
```

---
