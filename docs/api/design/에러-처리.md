# ⚠️ 에러 처리

## 에러 응답 구조

```typescript
interface ErrorResponse {
  success: false;
  message: string;           // 사용자 친화적 에러 메시지
  errorCode: string;         // 에러 코드 (상수)
  errors?: FieldError[];     // 필드 검증 에러 (선택)
  timestamp: string;         // 발생 시각
  path?: string;             // 요청 경로
}

interface FieldError {
  field: string;             // 필드 이름
  message: string;           // 에러 메시지
  rejectedValue?: any;       // 거부된 값
}
```

## 에러 코드 체계

```
{DOMAIN}_{ERROR_TYPE}
```

**Examples:**
```
USER_NOT_FOUND
USER_ALREADY_EXISTS
USER_VALIDATION_FAILED

POLICY_NOT_FOUND
POLICY_ACTIVATION_FAILED
POLICY_ALREADY_ACTIVE

CASE_NOT_FOUND
CASE_APPROVAL_DENIED
CASE_STATUS_INVALID

AUTHENTICATION_FAILED
UNAUTHORIZED
FORBIDDEN
PERMISSION_DENIED

INTERNAL_SERVER_ERROR
DATABASE_ERROR
EXTERNAL_API_ERROR
```

## 검증 에러 (400 Bad Request)

```json
{
  "success": false,
  "message": "Validation failed for user registration",
  "errorCode": "VALIDATION_ERROR",
  "errors": [
    {
      "field": "email",
      "message": "Email format is invalid",
      "rejectedValue": "invalid-email"
    },
    {
      "field": "password",
      "message": "Password must be at least 8 characters",
      "rejectedValue": "abc"
    },
    {
      "field": "username",
      "message": "Username is required",
      "rejectedValue": null
    }
  ],
  "timestamp": "2025-01-13T10:00:00Z",
  "path": "/api/v1/users"
}
```

## 비즈니스 규칙 위반 (422 Unprocessable Entity)

```json
{
  "success": false,
  "message": "Cannot activate policy: effective date is in the past",
  "errorCode": "POLICY_ACTIVATION_FAILED",
  "timestamp": "2025-01-13T10:00:00Z",
  "path": "/api/v1/policies/01ARZ3.../activate"
}
```

## 인증/인가 에러

```json
// 401 Unauthorized
{
  "success": false,
  "message": "JWT token is invalid or expired",
  "errorCode": "UNAUTHORIZED",
  "timestamp": "2025-01-13T10:00:00Z"
}

// 403 Forbidden
{
  "success": false,
  "message": "You do not have permission to access this resource",
  "errorCode": "FORBIDDEN",
  "timestamp": "2025-01-13T10:00:00Z"
}
```

## 서버 에러 (500)

```json
{
  "success": false,
  "message": "An unexpected error occurred. Please contact support.",
  "errorCode": "INTERNAL_SERVER_ERROR",
  "timestamp": "2025-01-13T10:00:00Z",
  "path": "/api/v1/users"
}
```

**Note:** 프로덕션 환경에서는 상세한 스택 트레이스를 응답에 포함하지 않음

---
