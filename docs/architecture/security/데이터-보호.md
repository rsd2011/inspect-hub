# π” λ°μ΄ν„° λ³΄νΈ

## Encryption at Rest

**λ°μ΄ν„°λ² μ΄μ¤ μ•”νΈν™”:**

```sql
-- PostgreSQL TDE (Transparent Data Encryption)
-- λλ” νμΌ μ‹μ¤ν… λ λ²¨ μ•”νΈν™” (LUKS, BitLocker)
```

**ν•„λ“ λ λ²¨ μ•”νΈν™” (PII):**

```java
@Entity
@Table(name = "user")
public class User {
    
    @Id
    private String id;
    
    private String username;
    
    @Convert(converter = EncryptedStringConverter.class)
    private String ssn;  // μ£Όλ―Όλ“±λ΅λ²νΈ μ•”νΈν™”
    
    @Convert(converter = EncryptedStringConverter.class)
    private String phoneNumber;  // μ „ν™”λ²νΈ μ•”νΈν™”
}
```

**Converter κµ¬ν„:**

```java
@Component
public class EncryptedStringConverter implements AttributeConverter<String, String> {
    
    @Autowired
    private EncryptionService encryptionService;
    
    @Override
    public String convertToDatabaseColumn(String attribute) {
        if (attribute == null) {
            return null;
        }
        return encryptionService.encrypt(attribute);
    }
    
    @Override
    public String convertToEntityAttribute(String dbData) {
        if (dbData == null) {
            return null;
        }
        return encryptionService.decrypt(dbData);
    }
}
```

**AES-256 μ•”νΈν™”:**

```java
@Service
public class EncryptionService {
    
    @Value("${encryption.secret-key}")
    private String secretKey;
    
    private static final String ALGORITHM = "AES/GCM/NoPadding";
    
    public String encrypt(String plainText) {
        try {
            SecretKey key = generateKey();
            Cipher cipher = Cipher.getInstance(ALGORITHM);
            
            byte[] iv = new byte[12];
            SecureRandom.getInstanceStrong().nextBytes(iv);
            GCMParameterSpec parameterSpec = new GCMParameterSpec(128, iv);
            
            cipher.init(Cipher.ENCRYPT_MODE, key, parameterSpec);
            byte[] encryptedData = cipher.doFinal(plainText.getBytes(StandardCharsets.UTF_8));
            
            // IV + Encrypted Data
            byte[] combined = new byte[iv.length + encryptedData.length];
            System.arraycopy(iv, 0, combined, 0, iv.length);
            System.arraycopy(encryptedData, 0, combined, iv.length, encryptedData.length);
            
            return Base64.getEncoder().encodeToString(combined);
        } catch (Exception e) {
            throw new EncryptionException("Encryption failed", e);
        }
    }
    
    public String decrypt(String encryptedText) {
        try {
            byte[] combined = Base64.getDecoder().decode(encryptedText);
            
            // Extract IV and encrypted data
            byte[] iv = new byte[12];
            byte[] encryptedData = new byte[combined.length - 12];
            System.arraycopy(combined, 0, iv, 0, 12);
            System.arraycopy(combined, 12, encryptedData, 0, encryptedData.length);
            
            SecretKey key = generateKey();
            Cipher cipher = Cipher.getInstance(ALGORITHM);
            GCMParameterSpec parameterSpec = new GCMParameterSpec(128, iv);
            
            cipher.init(Cipher.DECRYPT_MODE, key, parameterSpec);
            byte[] decryptedData = cipher.doFinal(encryptedData);
            
            return new String(decryptedData, StandardCharsets.UTF_8);
        } catch (Exception e) {
            throw new DecryptionException("Decryption failed", e);
        }
    }
    
    private SecretKey generateKey() throws Exception {
        byte[] keyBytes = secretKey.getBytes(StandardCharsets.UTF_8);
        MessageDigest sha = MessageDigest.getInstance("SHA-256");
        keyBytes = sha.digest(keyBytes);
        keyBytes = Arrays.copyOf(keyBytes, 32); // AES-256
        return new SecretKeySpec(keyBytes, "AES");
    }
}
```

## Encryption in Transit

**TLS/SSL (HTTPS):**

```yaml
# application.yml
server:
  port: 8443
  ssl:
    enabled: true
    key-store: classpath:keystore.p12
    key-store-password: ${SSL_KEYSTORE_PASSWORD}
    key-store-type: PKCS12
    key-alias: inspect-hub
    protocol: TLS
    enabled-protocols: TLSv1.3,TLSv1.2
```

**Certificate μƒμ„±:**

```bash
# Self-signed certificate (κ°λ°)
keytool -genkeypair -alias inspect-hub \
  -keyalg RSA -keysize 2048 \
  -storetype PKCS12 \
  -keystore keystore.p12 \
  -validity 365

# Production: Let's Encrypt λλ” CA λ°κΈ‰ μΈμ¦μ„ μ‚¬μ©
```

---
