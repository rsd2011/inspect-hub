# 📦 모듈 설명

## 1. common - 공통 모듈 (인프라)

**책임:**
- 모든 도메인 모듈이 공유하는 인프라 코드
- 데이터베이스 설정, 보안 설정, 유틸리티

**주요 컴포넌트:**
- `BaseDomain`: 모든 엔티티의 기본 클래스 (ID, 타임스탬프)
- `ApiResponse`: 통일된 API 응답 구조
- `GlobalExceptionHandler`: 전역 예외 처리
- `UlidGenerator`: ULID 식별자 생성
- `SecurityConfig`: Spring Security 설정
- `MyBatisConfig`: MyBatis 설정

**의존성:**
- 다른 모듈을 의존하지 않음

## 2. admin - 관리 도메인

**책임:**
- 사용자, 조직, 권한 관리
- 시스템 설정 관리
- 메뉴 및 코드 관리

**주요 API:**
- `POST /api/v1/users` - 사용자 생성
- `GET /api/v1/users` - 사용자 목록
- `PUT /api/v1/users/{id}` - 사용자 수정
- `GET /api/v1/organizations` - 조직 목록
- `POST /api/v1/permission-groups` - 권한 그룹 생성

**의존성:**
- `common`

## 3. policy - 정책 관리 도메인

**책임:**
- 정책 스냅샷 버전 관리
- KYC/STR/CTR/RBA/WLF 정책 기준 설정
- 정책 배포 및 승인 워크플로우

**핵심 개념: 스냅샷 기반 버전 관리**
- 불변성: 승인된 정책은 수정 불가
- 버전 체인: prev_id ↔ next_id 연결
- 롤백 지원: 이전 버전으로 되돌리기
- What-if 분석: 초안 스냅샷으로 시뮬레이션

**주요 테이블:**
- `standard_snapshot`: 정책 스냅샷 (type, version, effective_from/to)
- `standard_criteria`: 상세 기준 (JSON)

**주요 API:**
- `POST /api/v1/policies/snapshots` - 정책 스냅샷 생성
- `GET /api/v1/policies/snapshots/{id}` - 스냅샷 조회
- `PUT /api/v1/policies/snapshots/{id}/activate` - 정책 활성화
- `POST /api/v1/policies/snapshots/{id}/rollback` - 정책 롤백

**의존성:**
- `common`

## 4. detection - 탐지 엔진 도메인

**책임:**
- STR/CTR/WLF 탐지 규칙 실행
- 거래 데이터 분석
- 이벤트 생성

**핵심 개념: 배치 탐지 구조**
- `INSPECTION_INSTANCE`: 탐지 작업 인스턴스 (type, snapshot_ver, 생성 시간)
- `INSPECTION_EXECUTION`: 탐지 실행 이력 (status, start/end, 건수)
- `DETECTION_EVENT`: 탐지된 이벤트 (rule_id, severity)

**주요 API:**
- `POST /api/v1/detection/inspect` - 탐지 작업 시작
- `GET /api/v1/detection/events` - 탐지 이벤트 목록
- `GET /api/v1/detection/events/{id}` - 이벤트 상세

**의존성:**
- `common`, `policy`

## 5. investigation - 조사 도메인

**책임:**
- STR/CTR 사례 생성 및 관리
- 조사 활동 추적
- 승인 워크플로우 처리

**핵심 개념: 사례 생명주기**
- 이벤트 → 사례 생성
- 조사 → 증빙 자료 첨부
- 결재선 승인 → 보고
- 보관 → 폐기

**주요 테이블:**
- `alert_case`: 조사 사례
- `case_activity`: 활동 이력
- `case_attachment`: 첨부 파일

**주요 API:**
- `POST /api/v1/cases` - 사례 생성
- `GET /api/v1/cases` - 사례 목록
- `PUT /api/v1/cases/{id}/status` - 상태 변경
- `POST /api/v1/cases/{id}/activities` - 활동 기록

**의존성:**
- `common`, `detection`

## 6. reporting - 보고 도메인

**책임:**
- FIU 보고서 생성 (STR/CTR)
- 보고서 제출 이력 관리
- 통계 및 대시보드 데이터

**주요 테이블:**
- `report_str`: 의심거래보고서
- `report_ctr`: 고액현금거래보고서
- `submission_log`: 제출 이력

**주요 API:**
- `POST /api/v1/reports/str` - STR 보고서 생성
- `POST /api/v1/reports/ctr` - CTR 보고서 생성
- `GET /api/v1/reports` - 보고서 목록
- `POST /api/v1/reports/{id}/submit` - FIU 제출

**의존성:**
- `common`, `investigation`

## 7. batch - 배치 처리 모듈

**책임:**
- 야간 배치 탐지 작업
- 대량 데이터 처리 (Spring Batch)
- 통계 집계

**핵심 개념: Spring Batch 패턴**
- ItemReader → ItemProcessor → ItemWriter
- Chunk 기반 처리 (1000건씩)
- Skip/Retry 정책
- 병렬 처리 지원

**주요 Job:**
- `STR_DETECTION_JOB` - STR 탐지
- `CTR_DETECTION_JOB` - CTR 탐지
- `WLF_SCREENING_JOB` - WLF 필터링
- `DAILY_STATISTICS_JOB` - 일일 통계 집계

**의존성:**
- `common`, `detection`, `investigation`

## 8. simulation - 시뮬레이션 도메인

**책임:**
- What-if 분석
- 정책 백테스팅
- 리스크 시나리오 시뮬레이션

**주요 API:**
- `POST /api/v1/simulations` - 시뮬레이션 실행
- `GET /api/v1/simulations/{id}` - 시뮬레이션 결과
- `POST /api/v1/simulations/backtest` - 백테스트

**의존성:**
- `common`, `policy`, `detection`

## 9. server - 메인 애플리케이션

**책임:**
- 모든 도메인 모듈 통합
- Spring Boot 애플리케이션 부트스트랩
- 공통 설정 통합

**구성:**
- `InspectHubApplication.java` - 메인 클래스
- `application.yml` - 전역 설정
- 모든 도메인 모듈을 의존하여 하나의 애플리케이션으로 실행

**의존성:**
- 모든 도메인 모듈 (`admin`, `policy`, `detection`, `investigation`, `reporting`, `batch`, `simulation`)

---
