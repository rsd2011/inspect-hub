# 성능 테스트

## JMH Benchmark Test

```java
package com.inspecthub.performance;

import com.inspecthub.common.util.UlidGenerator;
import org.openjdk.jmh.annotations.*;
import org.openjdk.jmh.runner.Runner;
import org.openjdk.jmh.runner.options.Options;
import org.openjdk.jmh.runner.options.OptionsBuilder;

import java.util.concurrent.TimeUnit;

/**
 * ULID 생성 성능 벤치마크
 * 
 * 실행: ./gradlew jmh
 */
@BenchmarkMode(Mode.Throughput)
@OutputTimeUnit(TimeUnit.SECONDS)
@State(Scope.Thread)
@Warmup(iterations = 3, time = 1)
@Measurement(iterations = 5, time = 1)
@Fork(1)
public class UlidGenerationBenchmark {

    private UlidGenerator ulidGenerator;
    
    @Setup
    public void setup() {
        ulidGenerator = new UlidGenerator();
    }
    
    @Benchmark
    public String generateUlid() {
        return ulidGenerator.generate();
    }
    
    public static void main(String[] args) throws Exception {
        Options opt = new OptionsBuilder()
            .include(UlidGenerationBenchmark.class.getSimpleName())
            .build();
        
        new Runner(opt).run();
    }
}

/*
Expected Output:

Benchmark                              Mode  Cnt       Score       Error  Units
UlidGenerationBenchmark.generateUlid  thrpt    5  500000.000 ± 10000.000  ops/s

Interpretation:
- 500K ULID/sec = 충분한 성능
- 목표: >100K ops/s
*/
```

## Load Test with Gatling

```scala
// src/test/scala/com/inspecthub/simulation/UserApiLoadTest.scala
package com.inspecthub.simulation

import io.gatling.core.Predef._
import io.gatling.http.Predef._
import scala.concurrent.duration._

class UserApiLoadTest extends Simulation {

  val httpProtocol = http
    .baseUrl("http://localhost:8090")
    .acceptHeader("application/json")
    .contentTypeHeader("application/json")

  val scn = scenario("User API Load Test")
    .exec(
      http("Login")
        .post("/api/v1/auth/login")
        .body(StringBody("""{"username": "admin", "password": "admin123"}"""))
        .check(status.is(200))
        .check(jsonPath("$.data.accessToken").saveAs("token"))
    )
    .pause(1)
    .exec(
      http("List Users")
        .get("/api/v1/users?page=1&size=20")
        .header("Authorization", "Bearer ${token}")
        .check(status.is(200))
    )
    .pause(1)
    .exec(
      http("Get User Detail")
        .get("/api/v1/users/01HGW2N7XKQJBZ9VFQR8X7Y3ZT")
        .header("Authorization", "Bearer ${token}")
        .check(status.is(200))
    )

  setUp(
    scn.inject(
      rampUsersPerSec(10) to 500 during (2 minutes),  // 10 → 500 users/sec
      constantUsersPerSec(500) during (5 minutes)     // 500 users/sec for 5 min
    )
  ).protocols(httpProtocol)
   .assertions(
     global.responseTime.percentile3.lt(1000),  // 99th percentile < 1s
     global.successfulRequests.percent.gt(99)   // Success rate > 99%
   )
}
```

---
