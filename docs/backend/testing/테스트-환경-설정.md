# 테스트 환경 설정

## Gradle 의존성

```groovy
// build.gradle
dependencies {
    // JUnit 5 (Jupiter)
    testImplementation 'org.junit.jupiter:junit-jupiter:5.10.0'
    testRuntimeOnly 'org.junit.platform:junit-platform-launcher'
    
    // Mockito
    testImplementation 'org.mockito:mockito-core:5.5.0'
    testImplementation 'org.mockito:mockito-junit-jupiter:5.5.0'
    
    // AssertJ (Fluent Assertions)
    testImplementation 'org.assertj:assertj-core:3.24.2'
    
    // Spring Boot Test
    testImplementation 'org.springframework.boot:spring-boot-starter-test'
    
    // Spring Security Test
    testImplementation 'org.springframework.security:spring-security-test'
    
    // Testcontainers
    testImplementation 'org.testcontainers:testcontainers:1.19.0'
    testImplementation 'org.testcontainers:postgresql:1.19.0'
    testImplementation 'org.testcontainers:junit-jupiter:1.19.0'
    
    // RestAssured (API Testing)
    testImplementation 'io.rest-assured:rest-assured:5.3.2'
    testImplementation 'io.rest-assured:json-path:5.3.2'
    
    // Testcontainers for Kafka (if needed)
    testImplementation 'org.testcontainers:kafka:1.19.0'
    
    // H2 Database (for lightweight unit tests)
    testRuntimeOnly 'com.h2database:h2'
}

test {
    useJUnitPlatform()
    
    // 병렬 실행 설정
    maxParallelForks = Runtime.runtime.availableProcessors().intdiv(2) ?: 1
    
    // 테스트 리포트
    reports {
        html.required = true
        junitXml.required = true
    }
    
    // 테스트 실패 시 상세 출력
    testLogging {
        events "passed", "skipped", "failed"
        exceptionFormat "full"
        showStandardStreams = false
    }
}
```

## Test Application Properties

```yaml
# src/test/resources/application-test.yml
spring:
  profiles:
    active: test
  
  datasource:
    url: jdbc:tc:postgresql:14:///testdb
    driver-class-name: org.testcontainers.jdbc.ContainerDatabaseDriver
    username: test
    password: test
  
  jpa:
    hibernate:
      ddl-auto: create-drop
    show-sql: true
    properties:
      hibernate:
        format_sql: true
        use_sql_comments: true
  
  redis:
    host: localhost
    port: 6379
  
  kafka:
    bootstrap-servers: localhost:9092
  
  security:
    jwt:
      secret: test-secret-key-for-unit-tests-only-min-256-bits
      access-token-expiry: 3600000  # 1 hour
      refresh-token-expiry: 604800000  # 7 days

logging:
  level:
    root: INFO
    com.inspecthub: DEBUG
    org.springframework.security: DEBUG
    org.mybatis: DEBUG
```

## Base Test Classes

```java
// BaseUnitTest.java
package com.inspecthub.test;

import org.junit.jupiter.api.extension.ExtendWith;
import org.mockito.junit.jupiter.MockitoExtension;

/**
 * Base class for unit tests
 * - 외부 의존성 없음
 * - Mockito를 사용한 의존성 모킹
 */
@ExtendWith(MockitoExtension.class)
public abstract class BaseUnitTest {
    // Common setup can go here
}
```

```java
// BaseIntegrationTest.java
package com.inspecthub.test;

import org.junit.jupiter.api.Tag;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.ActiveProfiles;
import org.springframework.transaction.annotation.Transactional;
import org.testcontainers.junit.jupiter.Testcontainers;

/**
 * Base class for integration tests
 * - Spring Context 로드
 * - Testcontainers 사용
 * - 트랜잭션 롤백
 */
@SpringBootTest
@ActiveProfiles("test")
@Testcontainers
@Transactional
@Tag("integration")
public abstract class BaseIntegrationTest {
    
    @Container
    protected static PostgreSQLContainer<?> postgres = 
        new PostgreSQLContainer<>("postgres:14-alpine")
            .withDatabaseName("testdb")
            .withUsername("test")
            .withPassword("test");
    
    @DynamicPropertySource
    static void postgresProperties(DynamicPropertyRegistry registry) {
        registry.add("spring.datasource.url", postgres::getJdbcUrl);
        registry.add("spring.datasource.username", postgres::getUsername);
        registry.add("spring.datasource.password", postgres::getPassword);
    }
}
```

---
