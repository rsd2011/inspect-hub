# 모니터링 및 로깅

## Prometheus + Grafana

**Prometheus 설정**
```yaml
# k8s/prometheus-config.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: prometheus-config
  namespace: monitoring
data:
  prometheus.yml: |
    global:
      scrape_interval: 15s
      evaluation_interval: 15s
    
    scrape_configs:
    - job_name: 'kubernetes-pods'
      kubernetes_sd_configs:
      - role: pod
      relabel_configs:
      - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_scrape]
        action: keep
        regex: true
      - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_path]
        action: replace
        target_label: __metrics_path__
        regex: (.+)
      - source_labels: [__address__, __meta_kubernetes_pod_annotation_prometheus_io_port]
        action: replace
        regex: ([^:]+)(?::\d+)?;(\d+)
        replacement: $1:$2
        target_label: __address__
    
    - job_name: 'backend'
      static_configs:
      - targets: ['backend-service.production.svc.cluster.local:8090']
      metrics_path: '/actuator/prometheus'
```

**Grafana 대시보드**
- JVM 메트릭 (힙 메모리, GC, 스레드)
- HTTP 요청 메트릭 (RPS, 응답 시간, 에러율)
- 데이터베이스 커넥션 풀
- 비즈니스 메트릭 (탐지 건수, 사례 처리 시간)

## ELK Stack (로그 수집)

**Filebeat 설정**
```yaml
# k8s/filebeat-config.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: filebeat-config
  namespace: monitoring
data:
  filebeat.yml: |
    filebeat.inputs:
    - type: container
      paths:
        - /var/log/containers/*.log
      processors:
      - add_kubernetes_metadata:
          host: ${NODE_NAME}
          matchers:
          - logs_path:
              logs_path: "/var/log/containers/"
    
    output.elasticsearch:
      hosts: ['elasticsearch.monitoring.svc.cluster.local:9200']
      index: "inspecthub-%{+yyyy.MM.dd}"
```

---
