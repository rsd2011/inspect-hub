# 백업 및 복구

## 데이터베이스 백업

```bash
#!/bin/bash
# scripts/backup-database.sh

set -e

BACKUP_DIR="/var/backups/postgresql"
TIMESTAMP=$(date +%Y%m%d_%H%M%S)
DB_NAME="inspecthub_prod"
DB_USER="inspecthub_app"
DB_HOST="postgres-primary.production.svc.cluster.local"

# Full Backup
pg_dump -h $DB_HOST -U $DB_USER -Fc -f "$BACKUP_DIR/${DB_NAME}_${TIMESTAMP}.dump" $DB_NAME

# Upload to S3
aws s3 cp "$BACKUP_DIR/${DB_NAME}_${TIMESTAMP}.dump" \
  s3://inspecthub-backups/database/${DB_NAME}_${TIMESTAMP}.dump

# 7일 이상 오래된 백업 삭제
find $BACKUP_DIR -name "*.dump" -mtime +7 -delete

echo "✅ Backup completed: ${DB_NAME}_${TIMESTAMP}.dump"
```

## 복구

```bash
#!/bin/bash
# scripts/restore-database.sh

BACKUP_FILE=$1
DB_NAME="inspecthub_prod"
DB_USER="inspecthub_app"
DB_HOST="postgres-primary.production.svc.cluster.local"

if [ -z "$BACKUP_FILE" ]; then
  echo "Usage: ./restore-database.sh <backup_file>"
  exit 1
fi

# S3에서 다운로드
aws s3 cp "s3://inspecthub-backups/database/$BACKUP_FILE" /tmp/

# 복구
pg_restore -h $DB_HOST -U $DB_USER -d $DB_NAME -c /tmp/$BACKUP_FILE

echo "✅ Database restored from $BACKUP_FILE"
```

---
