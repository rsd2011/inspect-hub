# 7ï¸âƒ£ ì‹¤ì „ í™œìš© ì˜ˆì‹œ

## ì‹œë‚˜ë¦¬ì˜¤ 1: ìƒˆ ê¸°ëŠ¥ êµ¬í˜„

**ì‚¬ìš©ì ìš”ì²­:**
```
LoginPolicy ì—”í‹°í‹° ë° Repositoryë¥¼ TDDë¡œ êµ¬í˜„í•´ì£¼ì„¸ìš”.
```

**AI ì‘ë‹µ (ì´ìƒì  í˜•íƒœ):**

````markdown
# ğŸ“‹ ì‘ì—… ë¶„ì„

**ìš”ì²­ ë‚´ìš©:**
- LoginPolicy ë„ë©”ì¸ ì—”í‹°í‹° êµ¬í˜„
- LoginPolicyRepository ì¸í„°í˜ì´ìŠ¤ ë° MyBatis Mapper êµ¬í˜„
- TDD ë°©ì‹ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ ë¨¼ì € ì‘ì„±

**í•„ìš”í•œ ì‘ì—…:**
1. [RED] Domain ë ˆì´ì–´ í…ŒìŠ¤íŠ¸ ì‘ì„±
2. [GREEN] LoginPolicy Entity êµ¬í˜„
3. [RED] Repository ë ˆì´ì–´ í…ŒìŠ¤íŠ¸ ì‘ì„±
4. [GREEN] Repository ì¸í„°í˜ì´ìŠ¤ + MyBatis Mapper êµ¬í˜„
5. [REFACTOR] ì½”ë“œ ë¦¬íŒ©í† ë§

**ì‚¬ìš©í•  Skills:**
- DDD Domain Modeling
- MyBatis Code Generation
- JUnit 5 Test Generation

---

# ğŸ”´ RED: í…ŒìŠ¤íŠ¸ ë¨¼ì € ì‘ì„±

## 1. Domain Layer Test

```java
// File: backend/policy/src/test/java/com/inspecthub/policy/domain/LoginPolicyTest.java
package com.inspecthub.policy.domain;

import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;
import static org.assertj.core.api.Assertions.*;

import com.inspecthub.common.exception.DomainException;

class LoginPolicyTest {
    
    @Test
    @DisplayName("ëª¨ë“  ë¡œê·¸ì¸ ë°©ì‹ì´ ë¹„í™œì„±í™”ë˜ë©´ ì˜ˆì™¸ê°€ ë°œìƒí•œë‹¤")
    void shouldThrowExceptionWhenAllMethodsDisabled() {
        // Given
        LoginPolicy policy = LoginPolicy.builder()
            .policyId("01HN2Z3K4M5N6P7Q8R9S0T1U2V")
            .adEnabled(true)
            .ssoEnabled(false)
            .localEnabled(false)
            .build();
        
        // When & Then
        assertThatThrownBy(() -> 
            policy.update(false, false, false, "", "admin"))
            .isInstanceOf(DomainException.class)
            .hasMessageContaining("ìµœì†Œ í•˜ë‚˜ì˜ ë¡œê·¸ì¸ ë°©ì‹");
    }
    
    @Test
    @DisplayName("ìœ íš¨í•œ ì •ì±… ì—…ë°ì´íŠ¸ ì‹œ ì„±ê³µí•œë‹¤")
    void shouldSucceedWhenUpdatingWithValidData() {
        // Given
        LoginPolicy policy = LoginPolicy.builder()
            .policyId("01HN2Z3K4M5N6P7Q8R9S0T1U2V")
            .adEnabled(true)
            .ssoEnabled(false)
            .localEnabled(false)
            .build();
        
        // When
        policy.update(false, true, false, "SSO,AD,LOCAL", "admin");
        
        // Then
        assertThat(policy.getSsoEnabled()).isTrue();
        assertThat(policy.getAdEnabled()).isFalse();
        assertThat(policy.getPriority()).isEqualTo("SSO,AD,LOCAL");
    }
}
```

---

# ğŸŸ¢ GREEN: ìµœì†Œ êµ¬í˜„

## 2. Domain Entity

```java
// File: backend/policy/src/main/java/com/inspecthub/policy/domain/LoginPolicy.java
package com.inspecthub.policy.domain;

import lombok.*;
import java.time.LocalDateTime;

@Getter
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@AllArgsConstructor
@Builder
public class LoginPolicy {
    
    private String policyId;
    private Boolean adEnabled;
    private Boolean ssoEnabled;
    private Boolean localEnabled;
    private String priority;
    private LocalDateTime updatedAt;
    private String updatedBy;
    
    public void validateAtLeastOneEnabled() {
        if (!adEnabled && !ssoEnabled && !localEnabled) {
            throw new DomainException("ìµœì†Œ í•˜ë‚˜ì˜ ë¡œê·¸ì¸ ë°©ì‹ì´ í™œì„±í™”ë˜ì–´ì•¼ í•©ë‹ˆë‹¤");
        }
    }
    
    public void update(Boolean adEnabled, Boolean ssoEnabled, Boolean localEnabled, 
                      String priority, String updatedBy) {
        this.adEnabled = adEnabled;
        this.ssoEnabled = ssoEnabled;
        this.localEnabled = localEnabled;
        this.priority = priority;
        this.updatedAt = LocalDateTime.now();
        this.updatedBy = updatedBy;
        
        validateAtLeastOneEnabled();
    }
}
```

---

# ğŸ”µ REFACTOR: ê°œì„ 

(í…ŒìŠ¤íŠ¸ëŠ” ê³„ì† í†µê³¼ ìœ ì§€)

## ê°œì„ ì‚¬í•­:
- âœ… Builder íŒ¨í„´ìœ¼ë¡œ ë¶ˆë³€ì„± ê°•í™”
- âœ… ë„ë©”ì¸ ë¡œì§ ë¶„ë¦¬ (validateAtLeastOneEnabled)
- âœ… ì—ëŸ¬ ë©”ì‹œì§€ ëª…í™•í™”
````

---

## ì‹œë‚˜ë¦¬ì˜¤ 2: ë¬¸ì„œ ìƒì„±

**ì‚¬ìš©ì ìš”ì²­:**
```
LoginPolicy ê¸°ëŠ¥ì˜ API ë¬¸ì„œë¥¼ Swaggerë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”.
```

**AI ì‘ë‹µ (ì´ìƒì  í˜•íƒœ):**

````markdown
# ğŸ“‹ ì‘ì—… ë¶„ì„

**ìš”ì²­ ë‚´ìš©:**
- LoginPolicy REST API Swagger ë¬¸ì„œí™”

**ì‚¬ìš©í•  Skills:**
- Swagger/OpenAPI Documentation
- Spring Boot REST API ë¬¸ì„œí™”

**ì‚¬ìš©í•  MCP ë„êµ¬:**
- Web: Springdoc OpenAPI 3.0 ìµœì‹  ê·œì¹™ ì¡°íšŒ

---

# ğŸ“š Swagger ë¬¸ì„œ (ìë™ ìƒì„±)

## Controller with Swagger Annotations

```java
// File: backend/policy/src/main/java/com/inspecthub/policy/interfaces/LoginPolicyController.java
package com.inspecthub.policy.interfaces;

import io.swagger.v3.oas.annotations.*;
import io.swagger.v3.oas.annotations.media.*;
import io.swagger.v3.oas.annotations.responses.*;
import io.swagger.v3.oas.annotations.tags.Tag;
import lombok.RequiredArgsConstructor;
import org.springframework.http.ResponseEntity;
import org.springframework.security.access.prepost.PreAuthorize;
import org.springframework.web.bind.annotation.*;

@RestController
@RequestMapping("/api/v1/login-policy")
@RequiredArgsConstructor
@Tag(name = "Login Policy", description = "ë¡œê·¸ì¸ ì •ì±… ê´€ë¦¬ API")
public class LoginPolicyController {
    
    private final LoginPolicyService loginPolicyService;
    
    @GetMapping
    @PreAuthorize("hasRole('ADMIN')")
    @Operation(
        summary = "ë¡œê·¸ì¸ ì •ì±… ì¡°íšŒ",
        description = "í˜„ì¬ í™œì„±í™”ëœ ë¡œê·¸ì¸ ì •ì±…ì„ ì¡°íšŒí•©ë‹ˆë‹¤.",
        responses = {
            @ApiResponse(
                responseCode = "200",
                description = "ì¡°íšŒ ì„±ê³µ",
                content = @Content(
                    mediaType = "application/json",
                    schema = @Schema(implementation = LoginPolicyResponse.class)
                )
            ),
            @ApiResponse(
                responseCode = "401",
                description = "ì¸ì¦ ì‹¤íŒ¨"
            ),
            @ApiResponse(
                responseCode = "403",
                description = "ê¶Œí•œ ì—†ìŒ"
            )
        }
    )
    public ResponseEntity<ApiResponse<LoginPolicyResponse>> getLoginPolicy() {
        LoginPolicyResponse response = loginPolicyService.getLoginPolicy();
        return ResponseEntity.ok(ApiResponse.success(response));
    }
    
    @PutMapping
    @PreAuthorize("hasRole('ADMIN')")
    @Operation(
        summary = "ë¡œê·¸ì¸ ì •ì±… ìˆ˜ì •",
        description = "ë¡œê·¸ì¸ ë°©ì‹ í™œì„±í™”/ë¹„í™œì„±í™” ë° ìš°ì„ ìˆœìœ„ë¥¼ ë³€ê²½í•©ë‹ˆë‹¤.",
        requestBody = @io.swagger.v3.oas.annotations.parameters.RequestBody(
            description = "ë¡œê·¸ì¸ ì •ì±… ë³€ê²½ ìš”ì²­",
            required = true,
            content = @Content(
                mediaType = "application/json",
                schema = @Schema(implementation = UpdateLoginPolicyRequest.class)
            )
        ),
        responses = {
            @ApiResponse(
                responseCode = "200",
                description = "ìˆ˜ì • ì„±ê³µ"
            ),
            @ApiResponse(
                responseCode = "400",
                description = "ìœ íš¨í•˜ì§€ ì•Šì€ ìš”ì²­ (ëª¨ë“  ë°©ì‹ ë¹„í™œì„±í™”)"
            )
        }
    )
    public ResponseEntity<ApiResponse<Void>> updateLoginPolicy(
            @RequestBody @Valid UpdateLoginPolicyRequest request) {
        loginPolicyService.updateLoginPolicy(request);
        return ResponseEntity.ok(ApiResponse.success(null));
    }
}
```

## DTO Schemas

```java
// File: backend/policy/src/main/java/com/inspecthub/policy/interfaces/dto/LoginPolicyResponse.java
package com.inspecthub.policy.interfaces.dto;

import io.swagger.v3.oas.annotations.media.Schema;
import lombok.*;

@Getter
@Builder
@NoArgsConstructor
@AllArgsConstructor
@Schema(description = "ë¡œê·¸ì¸ ì •ì±… ì‘ë‹µ")
public class LoginPolicyResponse {
    
    @Schema(description = "ì •ì±… ID", example = "01HN2Z3K4M5N6P7Q8R9S0T1U2V")
    private String policyId;
    
    @Schema(description = "AD ë¡œê·¸ì¸ í™œì„±í™”", example = "true")
    private Boolean adEnabled;
    
    @Schema(description = "SSO ë¡œê·¸ì¸ í™œì„±í™”", example = "true")
    private Boolean ssoEnabled;
    
    @Schema(description = "ì¼ë°˜ ë¡œê·¸ì¸ í™œì„±í™”", example = "false")
    private Boolean localEnabled;
    
    @Schema(description = "ë¡œê·¸ì¸ ë°©ì‹ ìš°ì„ ìˆœìœ„", example = "SSO,AD,LOCAL")
    private String priority;
}
```

---

# ğŸ“– ìƒì„±ëœ Swagger UI ë¯¸ë¦¬ë³´ê¸°

**URL**: `http://localhost:8080/swagger-ui.html`

**ì—”ë“œí¬ì¸íŠ¸ ëª©ë¡:**
- `GET /api/v1/login-policy` - ë¡œê·¸ì¸ ì •ì±… ì¡°íšŒ
- `PUT /api/v1/login-policy` - ë¡œê·¸ì¸ ì •ì±… ìˆ˜ì •

**Example Request (PUT):**
```json
{
  "adEnabled": true,
  "ssoEnabled": true,
  "localEnabled": false,
  "priority": "SSO,AD,LOCAL"
}
```

**Example Response (GET):**
```json
{
  "success": true,
  "data": {
    "policyId": "01HN2Z3K4M5N6P7Q8R9S0T1U2V",
    "adEnabled": true,
    "ssoEnabled": true,
    "localEnabled": false,
    "priority": "SSO,AD,LOCAL"
  }
}
```
````

---
