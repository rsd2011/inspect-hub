# 📜 공통 설계 원칙

## 1. 레이어별 책임 분리

| 레이어 | 책임 | 예외 처리 원칙 |
|--------|------|----------------|
| **Controller** | HTTP 요청/응답, 상태 코드 매핑 | 비즈니스 예외는 Service로 위임, 전역 핸들러로 전파 |
| **Service** | 유스케이스 비즈니스 로직, 트랜잭션 경계 | 예외 vs Result 패턴 선택, 도메인 조합 |
| **Domain** | 도메인 불변식 유지 | 생성/상태 전이 시 규칙 위반 즉시 예외 발생 |
| **Repository** | 영속화 로직 | JPA 예외를 Service로 전파 (변환 없음) |

## 2. 예외 vs 결과 객체 사용 기준

### 예외로 처리 (BusinessException)
- ✅ 유스케이스를 **중단**시키고 **롤백**되는 것이 자연스러운 실패
- ✅ 예시:
  - 인증 실패
  - 권한 부족
  - 필수 데이터 누락
  - 도메인 규칙 위반

### 결과 객체로 처리 (Result/Optional)
- ✅ 비즈니스 상 **"실패도 정상 분기"**로 간주되는 경우
- ✅ 예시:
  - 검색 결과 없음
  - 추천 스킵
  - 선택적 기능 실패 (degradation)

## 3. 전역 예외 처리 전략

**ErrorCode + BusinessException 조합:**
- `ErrorCode` enum: HTTP 상태, 내부 코드, 메시지 포함
- `BusinessException`: 비즈니스 에러
- `MethodArgumentNotValidException`: Bean Validation 실패 → 400
- `Exception`: 예측하지 못한 예외 → 500

## 4. 도메인 규칙 처리

- **도메인 불변식 위반** (음수 가격, 잘못된 상태 전이 등)은 도메인 계층에서 예외로 **즉시 발생**
- **도메인 객체는 항상 유효한 상태만 유지** (null/invalid 상태 최소화)

## 5. 함수형/불변/클린 코드 지향

- ✅ 불변 객체 사용 (DTO, Value Object)
- ✅ Stream, Optional 등 함수형 스타일 활용
- ✅ Early return으로 if/else 중첩 최소화

---
