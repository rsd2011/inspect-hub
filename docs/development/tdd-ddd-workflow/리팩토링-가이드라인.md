# 리팩토링 가이드라인

## 리팩토링 시점

**리팩토링은 Green 단계에서만 수행:**

```
Red → Green → Refactor
          ↑       ↑
      테스트 통과 후에만 리팩토링
```

## 리팩토링 규칙

1. **한 번에 하나의 리팩토링만**
2. **각 리팩토링 후 테스트 실행**
3. **기존 리팩토링 패턴 이름 사용**
4. **중복 제거와 가독성 개선 우선**

## 주요 리팩토링 패턴

### 1. Extract Method (메서드 추출)

**언제:** 메서드가 너무 길거나, 주석이 필요한 코드 블록

```java
// Before
public void processOrder(Order order) {
    // 재고 확인
    if (inventory.getQuantity(order.getProductId()) < order.getQuantity()) {
        throw new InsufficientStockException();
    }

    // 가격 계산
    BigDecimal price = product.getPrice().multiply(BigDecimal.valueOf(order.getQuantity()));
    if (order.hasDiscount()) {
        price = price.multiply(BigDecimal.valueOf(0.9));
    }

    // 주문 저장
    orderRepository.save(order);
}

// After
public void processOrder(Order order) {
    validateStock(order);
    BigDecimal price = calculatePrice(order);
    saveOrder(order);
}

private void validateStock(Order order) {
    if (inventory.getQuantity(order.getProductId()) < order.getQuantity()) {
        throw new InsufficientStockException();
    }
}

private BigDecimal calculatePrice(Order order) {
    BigDecimal price = product.getPrice().multiply(BigDecimal.valueOf(order.getQuantity()));
    if (order.hasDiscount()) {
        price = price.multiply(BigDecimal.valueOf(0.9));
    }
    return price;
}

private void saveOrder(Order order) {
    orderRepository.save(order);
}
```

### 2. Introduce Parameter Object (매개변수 객체화)

**언제:** 메서드 매개변수가 3개 이상

```java
// Before
public User createUser(String name, String email, String phone, String address) {
    // ...
}

// After
public class UserRegistrationInfo {
    private final String name;
    private final String email;
    private final String phone;
    private final String address;

    // constructor, getters
}

public User createUser(UserRegistrationInfo info) {
    // ...
}
```

### 3. Replace Conditional with Polymorphism (조건문을 다형성으로)

**언제:** 타입별 분기가 반복됨

```java
// Before
public BigDecimal calculateDiscount(Customer customer, BigDecimal amount) {
    if (customer.getType() == CustomerType.REGULAR) {
        return amount.multiply(BigDecimal.valueOf(0.05));
    } else if (customer.getType() == CustomerType.PREMIUM) {
        return amount.multiply(BigDecimal.valueOf(0.10));
    } else if (customer.getType() == CustomerType.VIP) {
        return amount.multiply(BigDecimal.valueOf(0.20));
    }
    return BigDecimal.ZERO;
}

// After
public interface DiscountPolicy {
    BigDecimal calculateDiscount(BigDecimal amount);
}

public class RegularDiscountPolicy implements DiscountPolicy {
    public BigDecimal calculateDiscount(BigDecimal amount) {
        return amount.multiply(BigDecimal.valueOf(0.05));
    }
}

public class PremiumDiscountPolicy implements DiscountPolicy {
    public BigDecimal calculateDiscount(BigDecimal amount) {
        return amount.multiply(BigDecimal.valueOf(0.10));
    }
}

public class VIPDiscountPolicy implements DiscountPolicy {
    public BigDecimal calculateDiscount(BigDecimal amount) {
        return amount.multiply(BigDecimal.valueOf(0.20));
    }
}

// Customer 클래스
public class Customer {
    private DiscountPolicy discountPolicy;

    public BigDecimal calculateDiscount(BigDecimal amount) {
        return discountPolicy.calculateDiscount(amount);
    }
}
```

---
