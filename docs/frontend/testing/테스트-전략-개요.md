# 테스트 전략 개요

## 테스트 피라미드

```
       /\
      /  \       E2E Tests (10%)
     /----\      - Playwright
    /      \     - 사용자 시나리오
   /--------\    
  / Integration\ Integration Tests (20%)
 /   Tests     \ - API 통합
/--------------\ - Store 통합
|              |
|  Unit Tests  | Unit Tests (70%)
|              | - Composables
|              | - Utils
|              | - 비즈니스 로직
|______________|
```

## 테스트 범위

| 레이어 | 테스트 유형 | 커버리지 목표 | 도구 |
|--------|-------------|---------------|------|
| **Composables** | Unit | 90%+ | Vitest |
| **Utils** | Unit | 95%+ | Vitest |
| **Components (Atoms)** | Unit | 85%+ | Vitest + Testing Library |
| **Components (Molecules/Organisms)** | Integration | 80%+ | Vitest + Testing Library |
| **Stores** | Unit | 85%+ | Vitest + Pinia Testing |
| **Pages** | E2E | 75%+ | Playwright |
| **User Flows** | E2E | 100% | Playwright |

## 핵심 원칙

### 1. TDD (Test-Driven Development) - 테스트 설계 기준 ⭐

**새로운 기능 구현 시 반드시 TDD 사이클을 준수한다:**

- **Red (실패하는 테스트 작성)**: 기능 구현 전 먼저 실패하는 테스트를 작성
- **Green (최소 코드로 통과)**: 테스트가 통과할 수 있는 최소한의 프로덕션 코드 작성
- **Refactor (리팩터링)**: 테스트가 통과한 상태에서 코드 개선

```typescript
// 1. Red: 실패하는 테스트 먼저 작성
describe('할인 계산기', () => {
  it('VIP 고객에게 20% 할인율을 적용한다', () => {
    // Given
    const vipUser = { membershipLevel: 'VIP' }

    // When
    const discount = calculateDiscount(vipUser)

    // Then
    expect(discount.rate).toBe(0.20)  // 아직 구현 안됨 → 테스트 실패
  })
})

// 2. Green: 최소 코드로 통과
export function calculateDiscount(user) {
  if (user.membershipLevel === 'VIP') {
    return { rate: 0.20 }  // 하드코딩도 OK
  }
  return { rate: 0.0 }
}

// 3. Refactor: 개선 (테스트는 계속 통과)
const DISCOUNT_RATES = {
  VIP: 0.20,
  GOLD: 0.15,
  SILVER: 0.10
}

export function calculateDiscount(user) {
  const rate = DISCOUNT_RATES[user.membershipLevel] || 0.0
  return { rate }
}
```

### 2. BDD (Behavior-Driven Development) - 테스트 표현 방식 ⭐

**각 테스트는 하나의 행동(Behavior)을 검증하도록 설계한다:**

**Given / When / Then 구조:**
- **Given (준비)**: 테스트 전제 조건 및 데이터 준비
- **When (실행)**: 테스트 대상 메서드/컴포넌트 실행
- **Then (검증)**: 예상 결과 검증

**테스트 명명 규칙:**
- ✅ **시나리오 문장 형태**로 작성
- ✅ `it()` 또는 `test()` 설명은 **한글 비즈니스 시나리오**로 작성
- ✅ 함수명은 `should_[예상결과]_when_[조건]()` 형식 (선택사항)

```typescript
// ✅ Good: BDD 스타일
describe('로그인 폼', () => {
  it('유효한 자격증명으로 로그인 시 대시보드로 이동한다', async () => {
    // Given (준비): 로그인 폼 렌더링
    const { getByLabel, getByRole } = render(LoginForm)
    const user = userEvent.setup()

    // When (실행): 사용자 입력 및 제출
    await user.type(getByLabel('사용자명'), 'admin')
    await user.type(getByLabel('비밀번호'), 'admin123')
    await user.click(getByRole('button', { name: '로그인' }))

    // Then (검증): 대시보드로 리다이렉트
    expect(mockRouter.push).toHaveBeenCalledWith('/dashboard')
  })

  it('비밀번호가 5회 이상 틀리면 계정이 잠긴다', async () => {
    // Given, When, Then...
  })
})

// ❌ Bad: 기술적 용어, 불명확한 시나리오
describe('LoginForm', () => {
  it('should work', () => {
    const wrapper = mount(LoginForm)
    expect(wrapper.exists()).toBe(true)
  })
})
```

**추가 예시:**
```typescript
it('만료된 토큰으로 API 호출 시 401 에러를 반환한다', () => {})
it('중복된 이메일로 가입 시 검증 에러를 표시한다', () => {})
it('파일 업로드 진행률이 실시간으로 업데이트된다', () => {})
```

### 3. F.I.R.S.T 원칙

- **Fast**: 빠른 실행 (<1초/테스트)
- **Independent**: 독립적 실행 가능
- **Repeatable**: 반복 가능
- **Self-validating**: 자동 검증
- **Timely**: 적시 작성 (TDD - 코드 작성 전!)

### 4. 테스트 우선순위

- **High**: 비즈니스 로직, 데이터 변환, 보안 관련
- **Medium**: UI 컴포넌트, 사용자 인터랙션
- **Low**: 스타일, 애니메이션

### 5. 사용자 중심 테스트

- 구현 세부사항이 아닌 사용자 관점에서 테스트
- 접근성 우선 (role, label 기반 쿼리)
- 실제 사용자 행동 시뮬레이션

---
